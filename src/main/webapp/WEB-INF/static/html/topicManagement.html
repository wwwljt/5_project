<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Topic Management</title>
    <link href="../layui/css/layui.css" rel="stylesheet" charset="utf-8">

    <style type="text/css">
        .demoTable .layui-inline[lay-event] {
            position: relative;
            right: 10px;
            width: 26px;
            height: 26px;
            padding: 5px;
            line-height: 16px;
            border: 1px solid #ccc;
            /*å˜å°æ‰‹*/
            cursor: pointer;
            transition: .5s all;
        }
    </style>

</head>
<body>

<!--æ·»åŠ æœç´¢æŒ‰é’®å’Œæœç´¢æ¡†-->
<div class="demoTable" style="margin: 15px;">


    <button class="layui-btn" id="btn-add"><i class="layui-icon layui-icon-add-circle" style="font-size: 20px; color: white;"></i>æ·»åŠ </button>
    <button class="layui-btn layui-btn-warm" id="btn-remove" lay-event="getCheckData">
        <i class="layui-icon layui-icon-reduce-circle" style="font-size: 20px; color: white;"></i>åˆ é™¤
    </button>

    <span style="margin-left: 50px;">æœç´¢é—®é¢˜ï¼š</span>
    <div class="layui-inline">
        <input class="layui-input"  id="searchQuestion" autocomplete="off">
    </div>

    <span style="margin-left: 50px;">æœç´¢åˆ›å»ºäººï¼š</span>
    <div class="layui-inline">
        <input class="layui-input"  id="createPerson" autocomplete="off">
    </div>
    <button class="layui-btn" data-type="reload" id="search"><i class="layui-icon layui-icon-search" style="font-size: 20px; color: white;"></i>æœç´¢</button>
    <button class="layui-btn" data-type="reload" id="resetSearch"><i class="layui-icon layui-icon-refresh" style="font-size: 20px; color: white;"></i>é‡ç½®</button>
</div>


<table class="layui-hide" id="testTopicManagement" lay-filter="TopicManagementDemo"></table>

<!--ç¼–è¾‘æ¨¡æ€æ¡†-->
<div class="layui-row" id="open_div" style="display:none;">

    <div id="add_form" class="layui-form" lay-filter="edit" action="" style="margin-top: 20px;align:center;">

        <div class="layui-form-item">
            <label class="layui-form-label"> ID </label>
            <div class="layui-input-inline" style="width: 65%">
                <input id="deptId" lay-verify="number" readonly="readonly" type="text" name="id"
                       placeholder="é¢˜ç›®ID"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">é—®é¢˜</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="question" type="text" name="question"
                       placeholder="è¯·è¾“å…¥é—®é¢˜"  autofocus
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹A</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opa" type="text" name="option_a"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹A" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹B</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opb" type="text" name="option_b"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹B" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹C</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opc" type="text" name="option_c"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹C" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹D</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opd" type="text" name="option_d"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹D" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">ç±»å‹</label>
            <div class="layui-input-inline" style="width: 65%">
<!--                <input required lay-verify="required" id="type" type="text" name="type"-->
<!--                       placeholder="è¯·è¾“å…¥ç±»å‹" autofocus-->
<!--                       class="layui-input" autocomplete="off">-->


                    <select name="type" lay-filter="TypeZero" >
                        <option value="1">SASæ­£å‘è®¡åˆ†</option>
                        <option value="0">SASåå‘è®¡åˆ†</option>
                    </select>

            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">çŠ¶æ€</label>
            <div class="layui-input-inline" style="width: 65%">
<!--                <input required lay-verify="required" id="status" type="text" name="status"-->
<!--                       placeholder="è¯·è¾“å…¥çŠ¶æ€" autofocus-->
<!--                       class="layui-input" autocomplete="off" >-->

                <input type="checkbox" name="status" lay-skin="switch" lay-text="å¯ç”¨|å¤±æ•ˆ" value="1" checked >
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block" style="margin-left: 150px;">
                <button class="layui-btn" lay-submit lay-filter="update_submit" style="width: 200px;" >ç«‹å³æäº¤</button>
            </div>
        </div>
    </div>
</div>


<!--æ·»åŠ æ¨¡æ€æ¡†-->
<div class="layui-row" id="open_add_div" style="display:none;">

    <div id="add_form1" class="layui-form" lay-filter="add" action="" style="margin-top: 20px;align:center;">

        <div class="layui-form-item">
            <label class="layui-form-label">é—®é¢˜</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="question1" type="text" name="question1"
                       placeholder="è¯·è¾“å…¥é—®é¢˜"  autofocus
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹A</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opa1" type="text" name="opa1"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹A" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹B</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opb1" type="text" name="opb1"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹B" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹C</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opc1" type="text" name="opc1"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹C" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">é€‰é¡¹D</label>
            <div class="layui-input-inline" style="width: 65%">
                <input required lay-verify="required" id="opd1" type="text" name="opd1"
                       placeholder="è¯·è¾“å…¥é€‰é¡¹D" autofocus
                       class="layui-input" autocomplete="off">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">ç±»å‹</label>
            <div class="layui-input-inline" style="width: 65%">

                <select name="type1" >
                    <option value="1">SASæ­£å‘è®¡åˆ†</option>
                    <option value="0">SASåå‘è®¡åˆ†</option>
                </select>

            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">çŠ¶æ€</label>
            <div class="layui-input-inline" style="width: 65%">

                <input type="checkbox" name="status1" lay-skin="switch" lay-text="å¯ç”¨|å¤±æ•ˆ" value="1" checked >

            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block" style="margin-left: 150px;">
                <button class="layui-btn" lay-submit lay-filter="update_submit1" style="width: 200px;" >ç«‹å³æäº¤</button>
            </div>
        </div>
    </div>
</div>


<!--å³ä¾§å·¥å…·æ -->
<script type="text/html" id="barDemo">
    <!--    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">æŸ¥çœ‹</a>-->
    <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
</script>

<!--ç»‘å®šæ¨¡æ¿é€‰æ‹©å™¨-->
<!--çŠ¶æ€æ -->
<script type="text/html" id="buttonTpl">
    {{#  if(d.status == 1){ }}
    <button class="layui-btn layui-btn-xs">å¯ç”¨</button>
    {{#  } else { }}
    <button class="layui-btn layui-btn-primary layui-btn-xs">å¤±æ•ˆ</button>
    {{#  } }}
</script>

</body>

<script src="../layui/layui.js" charset="utf-8"></script>

<script>

    layui.use(['table'], function () {
        var table = layui.table;
        var $ = layui.jquery;
        var util = layui.util;
        var laypage = layui.laypage,
            layer = layui.layer;


        // åˆ›å»ºæ¸²æŸ“å®ä¾‹
        table.render({
            elem: '#testTopicManagement'
            , url: '/findQuestionSasAll'
            , method: 'get'
            , toolbar: true
            , defaultToolbar: ['filter', 'exports', 'print', {
                title: 'å¸®åŠ©'
                , layEvent: 'LAYTABLE_TIPS'
                , icon: 'layui-icon-tips'
            }]
            , page: {  // å…è®¸åˆ†é¡µ
                first: 1,
                limits: [10, 20, 30, 40, 50],  // è§„å®šæ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°
                limit: 10,  // è§„å®šé»˜è®¤æ˜¾ç¤ºæ¡æ•°
            }
            , cols: [[
                {type: 'checkbox', fixed: 'left'}
                , {field: 'id', fixed: 'left', width: 80, title: 'ID', sort: true}
                , {field: 'question', width: 150, title: 'é—®é¢˜'}
                , {field: 'optionA', width: 150, title: 'é€‰é¡¹A'}
                , {field: 'optionB', width: 150, title: 'é€‰é¡¹B'}
                , {field: 'optionC', width: 150, title: 'é€‰é¡¹C'}
                , {field: 'optionD', width: 150, title: 'é€‰é¡¹D'}
                , {
                    field: 'type',
                    width: 120,
                    title: 'ç±»å‹',
                    templet: function (d) {  // å‡½æ•°è½¬ä¹‰ç”¨æ³•ğŸ˜€
                        let res;
                        if (d.type == 1) {
                            res = "SASæ­£å‘è®¡åˆ†"
                        } else {
                            res = "SASåå‘è®¡åˆ†"
                        }
                        return res;
                    }

                }
                , {field: 'status', width: 80, title: 'çŠ¶æ€', templet: "#buttonTpl"}
                , {
                    field: 'createTime',
                    width: 170,
                    title: 'åˆ›å»ºæ—¶é—´',
                    templet: '<div>{{layui.util.toDateString(d.createTime, "yyyy-MM-dd HH:mm:ss") }}</div>'
                }
                , {field: 'createBy', width: 80, title: 'åˆ›å»ºäºº'}
                , {
                    field: 'updateTime',
                    width: 170,
                    title: 'ä¿®æ”¹æ—¶é—´',
                    templet: '<div>{{layui.util.toDateString(d.updateTime, "yyyy-MM-dd HH:mm:ss") }}</div>'
                }
                , {field: 'updateBy', width: 80, title: 'ä¿®æ”¹äºº'}
                // , {field: 'flag', width: 80, title: 'flag'}
                , {fixed: 'right', title: 'æ“ä½œ', width: 125, minWidth: 125, toolbar: '#barDemo'}

            ]]
            , id: 'searchTwo'

        });


        // ç›‘å¬å·¥å…·æ¡ï¼Œå®ç°åˆ é™¤åŠŸèƒ½
        table.on('tool(TopicManagementDemo)', function (obj) {    // genshinDemo è¡¨ç¤ºå·¥å…·åˆ—æ‰€åœ¨è¡¨æ ¼çš„ lay-filter çš„å€¼
            let data = obj.data;
            console.log("åˆ é™¤DATA==="+data);

            if (obj.event === 'del') {  //  ç»‘å®šäº‹ä»¶çš„åç§°

                layer.confirm('ç¡®è®¤åˆ é™¤IDä¸º' + data.id + 'çš„é¢˜ç›®å—?', function (index) {

                    let strIds = ""+data.id;

                    console.log("strIds==="+strIds);

                    layer.close(index);   // å…³é—­å¼¹æ¡†
                    // å‘æœåŠ¡ç«¯å‘é€åˆ é™¤å‘½ä»¤ï¼Œè·å–åç«¯
                    // alert("123123");
                    $.ajax({
                        type: 'get',
                        url: "/delTblQuestionSas",
                        data: {
                          ids: strIds,
                        },
                        // data: {
                        //     id: data.id,  // æ­¤å¤„æ˜¯æ ¹æ®idæŸ¥è¯¢æ­¤idæ˜¯å¦è¢«åˆ é™¤ï¼Œæ•…å°†idä¼ å‘åç«¯
                        // },
                        contentType: 'application/json',
                        success: function (data) {

                            console.log(data);

                            if (data == 1) {
                                obj.del();  // åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„
                                layer.msg('åˆ é™¤æˆåŠŸï¼', {icon: 1}, {time: 2000});  // icon ä¸ºå›¾æ ‡ï¼Œtimeä¸ºå¼¹å‡ºæ¡†æ¶ˆæ¯åœç•™æ—¶é—´

                            } else {
                                layer.msg('åˆ é™¤å¤±è´¥ï¼', {icon: 2}, {time: 2000});
                            }

                        }
                    })
                });
            }

            // ç›‘å¬å·¥å…·æ¡ï¼Œå®ç°ç¼–è¾‘åŠŸèƒ½
            else if (obj.event === 'edit') {

                let form = layui.form;
                form.val("edit", {
                    "id": data.id,
                    "question": data.question,
                    "option_a": data.optionA,
                    "option_b": data.optionB,
                    "option_c": data.optionC,
                    "option_d": data.optionD,
                    "type": data.type,
                    "status": data.status,
                });


                // æ‰“å¼€æ¨¡æ€æ¡†
                layer.open({
                    type: 1,//ç±»å‹
                    area:['500px','600px'],  //å®šä¹‰å®½å’Œé«˜
                    title:'ç¼–è¾‘é¢˜ç›®ä¿¡æ¯',  //é¢˜ç›®
                    shadeClose: true,  //ç‚¹å‡»é®ç½©å±‚å…³é—­
                    content: $('#open_div'),  //æ‰“å¼€çš„å†…å®¹
                    // btn: ['ç¡®å®š', 'å–æ¶ˆ']
                });


                // æ‹¿åˆ°ä¿®æ”¹åçš„æ•°æ®ï¼Œä¼ ç»™åç«¯
                form.on('submit(update_submit)', function (massage) {
                    console.log("messageä¸ºï¼š", massage);
                    let data1 = massage.field;
                    $.ajax({
                        type: "post",
                        url: "/editQuestionSas",
                        // data: JSON.stringify(massage.field),
                        data: {
                            "id": data1.id,
                            "question": data1.question,
                            "optionA": data1.option_a,
                            "optionB": data1.option_b,
                            "optionC": data1.option_c,
                            "optionD": data1.option_d,
                            "type": data1.type,
                            "status": data1.status,

                            "updateBy": "CM",
                        },

                        success: function (msg) {
                            console.log(msg);
                            layer.closeAll();//å…³é—­æ‰€æœ‰çš„å¼¹å‡ºå±‚
                            if (msg == 1) {
                                layer.msg("ä¿®æ”¹æˆåŠŸ", {icon: 6}, {time: 2000});

                                $(".layui-laypage-btn").click();  // CSHè‡ªåˆ›

                            } else {
                                layer.msg("ä¿®æ”¹å¤±è´¥", {icon: 5}, {time: 2000});
                            }
                        }
                    })
                    return false
                });

            }

        });


        // æ·»åŠ 
        $("#btn-add").click(function () {

            let form1 = layui.form;
            form1.val("add", {
                "question1": '',
                "opa1": '',
                "opb1": '',
                "opc1": '',
                "opd1": '',
                "type1": '',
                "status1": '',
            });


            // æ‰“å¼€æ¨¡æ€æ¡†
            layer.open({
                type: 1,//ç±»å‹
                area:['500px','600px'],  //å®šä¹‰å®½å’Œé«˜
                title:'æ·»åŠ é¢˜ç›®ä¿¡æ¯',  //é¢˜ç›®
                shadeClose: true,  //ç‚¹å‡»é®ç½©å±‚å…³é—­
                content: $('#open_add_div'),  //æ‰“å¼€çš„å†…å®¹
                // btn: ['ç¡®å®š', 'å–æ¶ˆ']
            });


            // æ‹¿åˆ°ä¿®æ”¹åçš„æ•°æ®ï¼Œä¼ ç»™åç«¯
            form1.on('submit(update_submit1)', function (massage) {
                console.log("messageä¸ºï¼š", massage);
                console.log(massage.field);
                let data1 = massage.field;
                $.ajax({
                    type: "post",
                    url: "/addTblQuestionSas",
                    // data: JSON.stringify(massage.field),
                    data: {
                        "question": data1.question1,
                        "optionA": data1.opa1,
                        "optionB": data1.opb1,
                        "optionC": data1.opc1,
                        "optionD": data1.opd1,
                        "type": data1.type1,
                        "status": data1.status1,

                        "createBy": "CSH",
                    },

                    success: function (msg) {
                        console.log(msg);
                        layer.closeAll();//å…³é—­æ‰€æœ‰çš„å¼¹å‡ºå±‚
                        if (msg == 1) {
                            layer.msg("æ·»åŠ æˆåŠŸï¼", {icon: 6}, {time: 2000});

                            $(".layui-laypage-btn").click();  //åˆ·æ–°æ•°æ®

                        } else {
                            layer.msg("æ·»åŠ å¤±è´¥ï¼", {icon: 5}, {time: 2000});
                        }
                    }
                })


                return false

            })

        });

        
        // æ‰¹é‡åˆ é™¤æ•°æ®
        $("#btn-remove").click(function () {
            let checkStatus = table.checkStatus('searchTwo');
            if (checkStatus.data.length == 0){
                console.log("checkData==="+checkStatus.data);
                parent.layer.msg('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ•°æ®è¡Œï¼', {icon: 2 , time:2000});
                return ;
            }

            console.log("checkStatus==="+checkStatus.data.id);

            // å¯¹æ‹¿åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†,è½¬ä¸ºå­—ç¬¦ä¸²
            let strIds = '';
            for (let i = 0; i < checkStatus.data.length; i++) {
                strIds += checkStatus.data[i].id + ';';
            }
            strIds = strIds.substring(0, strIds.length -1);  // å»æ‰ ; å·

            // å¼¹å‡ºç¡®è®¤åˆ é™¤æ¡†
            layer.confirm('ç¡®è®¤åˆ é™¤IDä¸º [' + strIds + '] çš„é¢˜ç›®å—?', function (index) {

                console.log("strIds==="+strIds)

                parent.layer.msg('åˆ é™¤ä¸­...', {icon: 16,shade: 0.3,time:2000});

                $.ajax({
                    type: 'get',
                    url: "/delTblQuestionSas",
                    data: {
                        ids: strIds,
                    },
                    contentType: 'application/json',
                    success: function (data) {

                        console.log(data);

                        if (data !== 0) {
                            layer.closeAll('loading');  // å…³é—­åŠ è½½åŠ¨ç”»
                            window.setTimeout(function () {  // å»¶æ—¶ä¸¤ç§’åå†æ‰§è¡Œæ–¹æ³•ä½“
                                layer.msg('åˆ é™¤æˆåŠŸï¼', {icon: 1}, {time: 1000});  // icon ä¸ºå›¾æ ‡ï¼Œtimeä¸ºå¼¹å‡ºæ¡†æ¶ˆæ¯åœç•™æ—¶é—´
                            }, 2000);

                            $(".layui-laypage-btn").click();  //åˆ·æ–°æ•°æ®
                        } else {
                            layer.closeAll('loading');  // å…³é—­åŠ è½½åŠ¨ç”»
                            window.setTimeout(function () {
                                layer.msg('åˆ é™¤å¤±è´¥ï¼', {icon: 2}, {time: 1000});
                            }, 2000);

                        }

                    }
                })

            })

        });


        // æœç´¢
        $('#search').click(function () {

            // alert("6666666666666");

            // è·å–ä¸¤ä¸ªè¾“å…¥æ¡†çš„å€¼
            let question = $('#searchQuestion').val();
            let person = $('#createPerson').val();

            if (question == "" && person == ""){
                parent.layer.msg('è¯·è¾“å…¥è¦æœç´¢çš„å†…å®¹ï¼', {icon: 2 , time:2000});
                return false;
            }

            //æ‰§è¡Œé‡è½½
            table.reload('searchTwo', {
                method: 'get'
                ,page: {
                    curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
                }
                ,where: {
                    question: question,
                    person: person,
                }
            });

        });

        // æœç´¢é‡ç½®
        $('#resetSearch').click(function () {

            // alert("6666666666666");

            $('#searchQuestion').val('');
            $('#createPerson').val('');

            // è·å–ä¸¤ä¸ªè¾“å…¥æ¡†çš„å€¼
            let question = '';
            let person = '';

            //æ‰§è¡Œé‡è½½
            table.reload('searchTwo', {
                method: 'get'
                , page: {
                    curr: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
                }
                , where: {
                    question: question,
                    person: person,
                }
            });
        })

    })






</script>


</html>