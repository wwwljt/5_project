<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.fivegroup.project.dao.TblTestPlanSasDao">


    <!--查找所有并分页-->
    <select id="findAll" resultType="com.fivegroup.project.entity.TblTestPlanSas">
        select *
        from tbl_test_plan_sas
        <where>
            <if test="testName != null">
                and test_name like '%' #{testName} '%'
            </if>
            <if test="person != null">
                and create_by like '%' #{person} '%'
            </if>
        </where>
        limit #{page}, #{limit}
    </select>


    <!--查询条数-->
    <select id="selectAll" resultType="java.lang.Integer">
        select count(*)
        from tbl_test_plan_sas
    </select>
    <select id="findSasTesterByPhone" resultType="com.fivegroup.project.entity.TblTesterSas">
        select *
        from w_gl.tbl_tester_sas
        where phone = #{phone};
    </select>
    <select id="findAllQuestion" resultType="com.fivegroup.project.entity.TblQuestionSas">
        select *
        from w_gl.tbl_question_sas
        where status = 1;
    </select>


    <!--删除-->
    <delete id="delData" parameterType="int">
        delete
        from tbl_test_plan_sas
        where id in
        <foreach collection="list" item="ids" open="(" separator="," close=")">
            #{ids}
        </foreach>
    </delete>


    <!--添加-->
    <insert id="addData">
        insert into tbl_test_plan_sas (test_code, test_name, test_begin, test_end, create_time, create_by, remark)
        values (#{tblTestPlanSas.testCode},
                #{tblTestPlanSas.testName},
                #{tblTestPlanSas.testBegin},
                #{tblTestPlanSas.testEnd},
                #{tblTestPlanSas.createTime},
                #{tblTestPlanSas.createBy},
                #{tblTestPlanSas.remark})
    </insert>
    <insert id="insert" keyProperty="tblTesterSas.id" useGeneratedKeys="true">
        insert into w_gl.tbl_tester_sas(`name`, phone, create_time, test_plan_id)
        values (#{tblTesterSas.name}, #{tblTesterSas.phone}, now(), #{tblTesterSas.testPlanId})
    </insert>
    <insert id="insertBatch">
        insert into w_gl.tbl_test_result_sas(tester_id, question_id, answer)
        values
        <foreach collection="answerList" item="entity" separator=",">
            (#{testerId}, #{entity.questionId}, #{entity.answer})
        </foreach>
    </insert>


    <!--编辑-->
    <update id="editData">
        update tbl_test_plan_sas
        set test_name   = #{tblTestPlanSas.testName},
            test_begin  = #{tblTestPlanSas.testBegin},
            test_end    = #{tblTestPlanSas.testEnd},
            update_time = #{tblTestPlanSas.updateTime},
            update_by   = #{tblTestPlanSas.updateBy},
            remark      = #{tblTestPlanSas.remark}
        where id = #{tblTestPlanSas.id}
    </update>

    <!--校验计划是否重复-->
    <select id="selectComparedPlan" resultType="java.lang.String">
        select test_name from tbl_test_plan_sas where test_name = #{plan}
    </select>
</mapper>